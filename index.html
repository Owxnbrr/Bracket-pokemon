<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bracket Tournoi</title>
  <style>
    :root{
      --bg:#071b3a;
      --panel:#0b2b57;
      --card:#0f3b78;
      --line:#b7c7ff55;
      --text:#eaf0ff;
      --muted:#a9b7e6;
      --accent:#ff8a2a;
      --gap:26px;
      --roundGap:56px;
      --cardW:320px;
      --cardH:64px;
      --radius:14px;
      --shadow: 0 10px 30px rgba(0,0,0,.28);
      --stroke: 2px;
    }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 500px at 70% 25%, #1b6bdc55, transparent 60%),
                  radial-gradient(900px 500px at 20% 60%, #2a8bff40, transparent 55%),
                  linear-gradient(180deg, #061634, #04102a 70%, #030b1d);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }

    .wrap{
      width:min(1200px, 100%);
      background: linear-gradient(180deg, #08224a90, #071b3a90);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding:22px 18px 18px;
      backdrop-filter: blur(8px);
    }

    .top{
      display:flex;
      align-items:center;
      gap:14px;
      justify-content:space-between;
      margin-bottom:18px;
    }
    .title{
      display:flex; flex-direction:column; gap:6px;
    }
    .title h1{
      margin:0;
      letter-spacing:.08em;
      font-size: 42px;
      font-weight: 900;
    }
    .title .sub{
      color:var(--muted);
      font-weight:700;
      letter-spacing:.06em;
      text-transform:uppercase;
      font-size:12px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      background: linear-gradient(90deg, #0b2b57, #0f3b78);
      border: 1px solid rgba(255,255,255,.10);
      padding:10px 12px;
      border-radius: 999px;
      color: var(--text);
      font-weight:800;
      letter-spacing:.05em;
      text-transform:uppercase;
      font-size:12px;
    }
    .badge .dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(255,138,42,.18);
    }

    /* BRACKET LAYOUT */
    .bracket{
      display:flex;
      gap: var(--roundGap);
      overflow:auto;
      padding: 8px 4px 18px;
    }

    .round{
      position:relative;
      min-width: var(--cardW);
      display:flex;
      flex-direction:column;
      gap: var(--gap);
    }

    .roundHeader{
      color: var(--muted);
      text-transform:uppercase;
      letter-spacing:.12em;
      font-size: 12px;
      font-weight: 800;
      margin: 6px 0 4px;
      padding-left: 6px;
    }

    /* Match card */
    .match{
      position:relative;
      width: var(--cardW);
      height: var(--cardH);
      border-radius: var(--radius);
      overflow:hidden;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
      display:grid;
      grid-template-columns: 1fr 52px;
      align-items:stretch;
    }
    .match .names{
      padding: 10px 12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 6px;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      font-weight:800;
      line-height:1;
    }
    .row .name{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 250px;
    }
    .row small{
      color: var(--muted);
      font-weight:700;
    }
    .scoreBox{
      background: var(--accent);
      color:#1a0f06;
      font-weight: 1000;
      font-size: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      letter-spacing:.03em;
    }

    .winner .name{ color: #ffffff; }
    .loser .name{ color: #d7defa; opacity:.85; }

    /* Connectors: from this match to next round */
    .match[data-next]::after{
      content:"";
      position:absolute;
      right:-30px;
      top: 50%;
      width: 30px;
      height: var(--stroke);
      background: var(--line);
      transform: translateY(-50%);
    }

    /* Vertical + horizontal connectors drawn on the NEXT round column */
    .round.nextRound .slot{
      position:relative;
    }
    .round.nextRound .slot::before{
      content:"";
      position:absolute;
      left:-30px;
      top: 0;
      bottom: 0;
      width: 30px;
      pointer-events:none;
    }

    /* helper line element */
    .vline{
      position:absolute;
      left:-30px;
      width: var(--stroke);
      background: var(--line);
      top: 0;
      bottom: 0;
    }
    .hline{
      position:absolute;
      left:-30px;
      height: var(--stroke);
      background: var(--line);
      width: 30px;
      top: 50%;
      transform: translateY(-50%);
    }

    /* Slots in later rounds so we can position connector lines */
    .slot{
      position:relative;
      width: var(--cardW);
      height: var(--cardH);
      display:flex;
      align-items:stretch;
    }

    /* Final highlight */
    .finalBadge{
      margin-left:6px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:900;
      color: #ffd9bf;
    }
    .finalBadge span{
      background: rgba(255,138,42,.14);
      border:1px solid rgba(255,138,42,.25);
      padding:4px 8px;
      border-radius:999px;
      font-size:12px;
      letter-spacing:.06em;
      text-transform:uppercase;
    }

    /* ===== Podium / Rewards banner ===== */
    .winnerBanner{
      margin-top: 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
      overflow:hidden;
    }

    .winnerBannerInner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      padding: 14px 16px;
    }

    .winnerLeft{
      display:flex;
      flex-direction:column;
      gap: 6px;
      min-width: 220px;
    }

    .winnerKicker{
      color: var(--muted);
      text-transform:uppercase;
      letter-spacing:.12em;
      font-weight: 900;
      font-size: 11px;
    }

    .winnerName{
      font-weight: 1000;
      letter-spacing:.02em;
      font-size: 18px;
    }

    .winnerName .crown{
      display:inline-block;
      margin-right: 8px;
      filter: drop-shadow(0 6px 14px rgba(0,0,0,.35));
    }

    .rewardGrid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      width: 100%;
    }

    .rewardCard{
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      display:flex;
      flex-direction:column;
      gap: 6px;
      min-height: 64px;
      transform: translateY(10px);
      opacity: 0;
      animation: riseIn .55s ease-out forwards;
    }

    .rewardCard:nth-child(1){ animation-delay: .08s; }
    .rewardCard:nth-child(2){ animation-delay: .18s; }
    .rewardCard:nth-child(3){ animation-delay: .28s; }

    .rewardTitle{
      font-weight: 1000;
      letter-spacing:.04em;
      text-transform:uppercase;
      font-size: 12px;
      display:flex;
      align-items:center;
      gap: 8px;
    }

    .rewardTitle .pill{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      font-size: 11px;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-weight: 1000;
      background: rgba(255,255,255,.05);
      color: var(--text);
      white-space:nowrap;
    }

    .rewardDesc{
      color: #d7defa;
      font-weight: 800;
      font-size: 13px;
      line-height: 1.25;
      opacity: .95;
    }

    .winnerBanner.isChampion{
      position:relative;
    }
    .winnerBanner.isChampion::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(600px 120px at 20% 0%, rgba(255,138,42,.45), transparent 60%),
                  radial-gradient(600px 120px at 80% 0%, rgba(255,138,42,.35), transparent 60%);
      opacity: .55;
      filter: blur(10px);
      pointer-events:none;
      animation: glowPulse 2.4s ease-in-out infinite;
    }

    @keyframes glowPulse{
      0%,100%{ opacity:.45; transform: translateY(0); }
      50%{ opacity:.75; transform: translateY(2px); }
    }

    @keyframes riseIn{
      to{
        transform: translateY(0);
        opacity: 1;
      }
    }

    @media (max-width: 980px){
      .winnerBannerInner{ flex-direction:column; align-items:stretch; }
      .rewardGrid{ grid-template-columns: 1fr; }
      .winnerLeft{ min-width: unset; }
    }

    @media (max-width: 520px){
      :root{ --cardW: 280px; --roundGap: 36px; }
      .title h1{ font-size: 34px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="title">
        <div class="sub">Cobblemon ‚Ä¢ Tournoi ‚Ä¢ √âlimination directe</div>
        <h1>BRACKET</h1>
      </div>
      <div class="badge"><span class="dot"></span> Single Elim ‚Ä¢ 6‚Äì7 joueurs</div>
    </div>

    <div id="bracket" class="bracket" aria-label="Bracket tournoi"></div>

    <!-- Podium / Rewards banner -->
    <div id="winnerBanner" class="winnerBanner" aria-live="polite">
      <div class="winnerBannerInner">
        <div class="winnerLeft">
          <div class="winnerKicker">Podium</div>

          <div class="winnerName" id="winnerName">
            <span class="crown">üèÜ</span>
            <span style="opacity:.9">En attente des r√©sultats‚Ä¶</span>
          </div>

          <div id="podiumList" style="margin-top:10px; display:flex; flex-direction:column; gap:8px; font-weight:900;">
            <div id="p1" style="display:flex; gap:10px; align-items:center;">
              <span style="width:34px; text-align:center;">ü•á</span>
              <span style="opacity:.85;">‚Äî</span>
            </div>
            <div id="p2" style="display:flex; gap:10px; align-items:center;">
              <span style="width:34px; text-align:center;">ü•à</span>
              <span style="opacity:.85;">‚Äî</span>
            </div>
            <div id="p3" style="display:flex; gap:10px; align-items:center;">
              <span style="width:34px; text-align:center;">ü•â</span>
              <span style="opacity:.85;">‚Äî</span>
            </div>
          </div>
        </div>

        <div class="rewardGrid">
          <div class="rewardCard">
            <div class="rewardTitle"><span class="pill">ü•á 1er</span></div>
            <div class="rewardDesc">Master Ball x1 + Fossile IV Max x1 + Bonbon Rare x32</div>
          </div>

          <div class="rewardCard">
            <div class="rewardTitle"><span class="pill">ü•à 2e</span></div>
            <div class="rewardDesc">Hyper Ball x16 + Fossile Brilliant x1 + Bonbon Rare x16</div>
          </div>

          <div class="rewardCard">
            <div class="rewardTitle"><span class="pill">ü•â 3e</span></div>
            <div class="rewardDesc">Hyper Ball x8 + Bonbon Rare x8</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/**
 * Bracket single elimination 6‚Äì7 joueurs
 * - Finale BO3 + Petite finale (3e place)
 * - Podium auto: 1er/2e via finale, 3e via petite finale
 */
const players = [
  // "Owxnbrr",
  // "Turuk",
  // "King",
  // "Zaliky",
  // "Sensei",
  // "Nessia",
  // "Loufox",
];

const is7 = players.length === 7;
const is6 = players.length === 6;
if (!is6 && !is7) {
  alert("Mets 6 ou 7 joueurs dans le tableau players.");
}

const round1 = [];
let idx = 0;

if (is6) {
  round1.push(makeMatch(players[idx++], players[idx++], "QF A"));
  round1.push(makeMatch(players[idx++], players[idx++], "QF B"));

  const bye1 = players[idx++];
  const bye2 = players[idx++];

  const semi1 = makeMatch("Gagnant QF A", bye1 + " (BYE)", "SF 1");
  const semi2 = makeMatch("Gagnant QF B", bye2 + " (BYE)", "SF 2");

  const finale = makeMatch("Gagnant SF 1", "Gagnant SF 2", "FINALE", "‚Äî", null);
  const thirdPlace = makeMatch("Perdant SF 1", "Perdant SF 2", "3E PLACE", "‚Äî", null);

  renderBracket([round1, [semi1, semi2], [finale, thirdPlace]]);
  updateWinnerBanner(finale, thirdPlace);
}

if (is7) {
  // Quarts (modifie score + winner "a"/"b"/null)
  round1.push(makeMatch(players[idx++], players[idx++], "QF A", "0-0", "null"));
  round1.push(makeMatch(players[idx++], players[idx++], "QF B", "0-0", "null"));
  round1.push(makeMatch(players[idx++], players[idx++], "QF C", "0-0", "null"));

  const bye = players[idx++];

  const qfA_w = getWinner(round1[0]);
  const qfB_w = getWinner(round1[1]);
  const qfC_w = getWinner(round1[2]);

  // Demis (modifie score + winner "a"/"b"/null)
  const semi1 = makeMatch(qfA_w, bye + " (BYE)", "SF 1", "0-0", "null");
  const semi2 = makeMatch(qfB_w, qfC_w, "SF 2", "0-0", "null");

  const sf1_w = getWinner(semi1);
  const sf2_w = getWinner(semi2);
  const sf1_l = getLoser(semi1);
  const sf2_l = getLoser(semi2);

  // Finale BO3 (modifie score + winner "a"/"b"/null)
  const finale = makeMatch(sf1_w, sf2_w, "FINALE", "0-0", "null");

  // Petite finale (3e place) (modifie score + winner "a"/"b"/null)
  const thirdPlace = makeMatch(sf1_l, sf2_l, "3E PLACE", "0-0", "null");

  renderBracket([round1, [semi1, semi2], [finale, thirdPlace]]);
  updateWinnerBanner(finale, thirdPlace);
}

// ------------ UI Render ------------

function renderBracket(rounds){
  const el = document.getElementById("bracket");
  el.innerHTML = "";

  rounds.forEach((round, rIndex) => {
    const col = document.createElement("div");
    col.className = "round" + (rIndex > 0 ? " nextRound" : "");
    col.innerHTML = `<div class="roundHeader">${roundTitle(rIndex, rounds.length)}</div>`;

    round.forEach((m) => {
      const slot = document.createElement("div");
      slot.className = "slot";

      const card = document.createElement("div");
      card.className = "match";
      card.dataset.label = m.label;

      const score = m.score ?? "";

      card.innerHTML = `
        <div class="names">
          <div class="row winner"><span class="name">${escapeHtml(m.a)}</span><small>${escapeHtml(m.label)}</small></div>
          <div class="row loser"><span class="name">${escapeHtml(m.b)}</span><small>${m.tagB ?? ""}</small></div>
        </div>
        <div class="scoreBox">${escapeHtml(score)}</div>
      `;

      slot.appendChild(card);
      col.appendChild(slot);
    });

    if (rIndex === rounds.length - 1) {
      const badge = document.createElement("div");
      badge.className = "finalBadge";
      badge.innerHTML = `<span>Finale</span> <div style="opacity:.9">BO3</div>`;
      col.insertBefore(badge, col.children[1]);
    }

    el.appendChild(col);
  });

  drawConnectors(el);
}

function drawConnectors(container){
  const cols = [...container.querySelectorAll(".round")];

  for (let i = 0; i < cols.length - 1; i++){
    const fromSlots = [...cols[i].querySelectorAll(".slot")];
    const toSlots = [...cols[i+1].querySelectorAll(".slot")];

    const pairs = [];

    // Cas sp√©cial: 2 demis -> 2 matchs (finale + 3e place)
    if (fromSlots.length === 2 && toSlots.length === 2) {
      pairs.push({from:[0,1], to:0, single:false});
      pairs.push({from:[0,1], to:1, single:false});
    }
    else if (fromSlots.length === 2 && toSlots.length === 1) {
      pairs.push({from:[0,1], to:0, single:false});
    }
    else if (fromSlots.length === 3 && toSlots.length === 2) {
      pairs.push({from:[0], to:0, single:true});       // QF A -> SF 1 (avec BYE)
      pairs.push({from:[1,2], to:1, single:false});    // QF B & QF C -> SF 2
    }
    else {
      for (let t=0; t<toSlots.length; t++){
        const a = t*2, b = t*2+1;
        if (b < fromSlots.length) pairs.push({from:[a,b], to:t, single:false});
        else if (a < fromSlots.length) pairs.push({from:[a], to:t, single:true});
      }
    }

    pairs.forEach(p => {
      const toSlot = toSlots[p.to];

      p.from.forEach(fi => {
        const fromCard = fromSlots[fi].querySelector(".match");
        fromCard.dataset.next = "1";
      });

      if (p.single){
        const h = document.createElement("div");
        h.className = "hline";
        toSlot.appendChild(h);
        return;
      }

      const firstFromRect = fromSlots[p.from[0]].getBoundingClientRect();
      const lastFromRect  = fromSlots[p.from[p.from.length-1]].getBoundingClientRect();
      const toRect = toSlot.getBoundingClientRect();

      const top = (firstFromRect.top + firstFromRect.bottom)/2 - toRect.top;
      const bot = (lastFromRect.top + lastFromRect.bottom)/2 - toRect.top;

      const v = document.createElement("div");
      v.className = "vline";
      v.style.top = `${Math.min(top, bot)}px`;
      v.style.height = `${Math.abs(bot - top)}px`;

      const h = document.createElement("div");
      h.className = "hline";

      toSlot.appendChild(v);
      toSlot.appendChild(h);
    });
  }
}

// ------------ Podium banner ------------

function updateWinnerBanner(finaleMatch, thirdPlaceMatch){
  const banner = document.getElementById("winnerBanner");
  const nameEl = document.getElementById("winnerName");

  const p1 = document.getElementById("p1").querySelector("span:last-child");
  const p2 = document.getElementById("p2").querySelector("span:last-child");
  const p3 = document.getElementById("p3").querySelector("span:last-child");

  const hasFinal = finaleMatch && (finaleMatch.winner === "a" || finaleMatch.winner === "b");
  const hasThird = thirdPlaceMatch && (thirdPlaceMatch.winner === "a" || thirdPlaceMatch.winner === "b");

  if (!hasFinal) {
    banner.classList.remove("isChampion");
    nameEl.innerHTML = `<span class="crown">üèÜ</span> <span style="opacity:.9">En attente des r√©sultats‚Ä¶</span>`;
    p1.textContent = "‚Äî";
    p2.textContent = "‚Äî";
    p3.textContent = "‚Äî";
    return;
  }

  const champion = getWinner(finaleMatch);
  const second = getLoser(finaleMatch);

  banner.classList.add("isChampion");
  const scoreTxt = finaleMatch?.score ? ` <span style="opacity:.75;font-weight:900">(${escapeHtml(finaleMatch.score)})</span>` : "";
  nameEl.innerHTML = `<span class="crown">üèÜ</span> Champion : <span style="color:#fff">${escapeHtml(champion)}</span>${scoreTxt}`;

  p1.textContent = champion;
  p2.textContent = second;

  if (hasThird) {
    const third = getWinner(thirdPlaceMatch);
    p3.textContent = third;
  } else {
    p3.textContent = "√Ä jouer";
  }
}

// ------------ Data helpers ------------

function makeMatch(a, b, label, score, winner){
  return { a, b, label, score, winner }; // winner = "a" | "b" | null
}

function getWinner(match){
  if (match.winner === "a") return match.a;
  if (match.winner === "b") return match.b;
  return "Gagnant " + match.label;
}

function getLoser(match){
  if (match.winner === "a") return match.b;
  if (match.winner === "b") return match.a;
  return "Perdant " + match.label;
}

function roundTitle(i, total){
  if (i === 0) return "Quarts";
  if (i === total-1) return "Finale";
  return "Demi-finales";
}

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",
    '"':"&quot;","'":"&#039;"
  }[s]));
}
</script>
</body>
</html>
